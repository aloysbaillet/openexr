# C/C++ with GCC
# Build your C/C++ project with GCC using make.
# Add steps that publish test results, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/apps/c-cpp/gcc

trigger:
- testing_azure

jobs:
- job: Linux
  pool:
    vmImage: 'ubuntu-16.04'
  container: aloysbaillet/aswf-vfx2018-conan:latest
  steps:
  - bash: |
      mkdir build
      conan install . --install-folder build/
    displayName: Prepare
  - bash: |
      cd build
      source activate.sh
      source activate_run.sh
      cmake .. -DCMAKE_TOOLCHAIN_FILE=conan_paths.cmake
      make -j8
    displayName: Build
  - bash: |
      cd build
      source activate.sh
      source activate_run.sh
      ctest -VV
    displayName: Test
